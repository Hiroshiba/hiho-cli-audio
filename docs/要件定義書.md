# hiho-cli-audio 機能要件定義書

## 1. はじめに

### 1.1 目的

本ドキュメントは、Gemini（または同等の音声認識 API）を利用した、Mac／Windows 対応 CLI アプリケーション（以下、本システム）の機能要件および非機能要件を定義することを目的とする。

### 1.2 背景

- 使用者は開発者（ドキュメント作成者）1 人のみを想定。
- ショートカットキーでトリガーし、マイク音声を文字起こしした結果をクリップボードへコピーするシンプルな CLI ツールとする。

---

## 2. 対象範囲

- **対象プラットフォーム**：macOS（最新 2 バージョン）、Windows 10/11
- **対象ユーザー**：開発者本人のみ（単一ユーザー想定）
- **対象機能**：以下セクション「機能要件」に定義
- **除外事項**：初版では GUI 化せず、CLI のみで完結

---

## 3. 用語定義

| 用語           | 意味                                                       |
| -------------- | ---------------------------------------------------------- |
| 本システム     | Gemini 音声認識 CLI ツール                                 |
| API キー       | Gemini（または同等 API）を呼び出すための認証トークン       |
| ショートカット | OS 標準またはユーティリティで定義するホットキー            |
| デーモン       | 常駐プロセス                                               |
| トークン数     | API 利用時に消費される「入力トークン数」「出力トークン数」 |

---

## 4. 機能要件

### 4.1 起動・常駐

1. システム起動時にデーモンとしてバックグラウンドで常駐。
2. 起動時に依存関係不足などでエラーが発生した場合、エラーメッセージをターミナルに表示してプロセスを終了。

### 4.2 ショートカットキー検知

1. 常駐中に、ユーザー定義のショートカットキー入力を待機。
2. キー入力を検知次第、音声認識処理を開始。

### 4.3 音声認識処理

1. マイク入力を収集し、Gemini 音声認識 API へ送信。
2. API キーは、設定ファイル（例：`~/.config/hiho-cli-audio/config.yaml` など）から読み込む。
3. API リクエスト失敗時は処理を中断し、後述のエラー処理を経て待機状態に戻る。
4. 認識完了後、取得テキストと同時に「入力トークン数」「出力トークン数」をログに出力。

### 4.4 ユーザーへのフィードバック

1. 認識開始直後に軽い「開始音」を再生。
2. API 呼び出し中は、CLI 上のプログレスバー表示のみで進捗を示す。
3. 認識完了時に「完了音」を再生。

### 4.5 クリップボード操作

1. 認識結果のテキストを、OS 標準のクリップボードに自動コピー。

### 4.6 エラー処理

1. ネットワークエラーや API キー未設定／無効時など、リクエスト失敗時はターミナルにエラーメッセージを表示し、デーモンは継続して待機に戻る。

---

## 5. 非機能要件

| 項目             | 要件                                                                                   |
| ---------------- | -------------------------------------------------------------------------------------- |
| 対応 OS          | macOS（最新 2 バージョン）、Windows 10/11                                              |
| 開発言語         | Python                                                                                 |
| 依存管理         | Rust 製次世代ツール「uv」を利用し、仮想環境作成とパッケージ管理を一元化する            |
| パフォーマンス   | 起動から待機状態まで 5 秒以内（API 呼び出し時間除く）                                  |
| セキュリティ     | API キーは環境変数ではなく設定ファイルで管理し、ファイルはホームディレクトリ配下に保存 |
| シングルユーザー | 設定ファイルやキャッシュはユーザーのホームディレクトリ配下に配置                       |

---

## 6. 外部インタフェース要件

### 6.1 設定ファイル

- ファイルパス例：`~/.config/hiho-cli-audio/config.yaml`
- 設定項目例：

  ```yaml
  api_key: your_gemini_api_key
  shortcut: "Ctrl+Shift+D"
  ```

### 6.2 OS 連携

- **ショートカット登録**：OS 標準機能やユーティリティで登録（自動化不可）。
- **クリップボード操作**：各 OS の標準クリップボード API を使用。

---

## 7. ログ管理

- 標準出力または標準エラー出力にて、以下を出力：

  - 処理開始／完了のタイムスタンプ
  - 入力トークン数、出力トークン数
  - エラー発生時のメッセージ

---

## 8. 将来の拡張

- **GUI 化**：デスクトップオーバーレイや通知によるフィードバック表示。
